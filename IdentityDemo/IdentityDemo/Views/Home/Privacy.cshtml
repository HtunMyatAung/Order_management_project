@{
    Layout = "_Zone_layout";
}
<div class="header1">
    <h1>Top Free Games</h1>
    <div class="shop-cart" style="color:black">
        <form action="@Url.Action("Invoice", "Order")" method="post" id="cartForm">
            <button type="submit" class="cart-button" onclick="return checkAuthentication()">
                <i class="fas fa-shopping-basket"></i>
                <span class="cart-counter" id="cartCounter">0</span>
            </button>
        </form>
    </div>
</div>
<div class="container">
    <ul class="game-list">
        @foreach (var item in Model)
        {
            <li>
                <div class="game-item" data-name="@item.ItemName" data-price="@item.ItemPrice" data-shop="@item.Shop_Id">
                    <img src="../../img/product1.jpg" alt="@item.ItemName">
                    <button type="button" class="buy-button" onclick="addToCart(@item.ItemId)">Buy</button>
                    <div class="item-details">
                        <h3 class="item-name">@item.ItemName</h3>
                        <p class="item-price">$@item.ItemPrice</p>
                    </div>
                    <p class="item-shop">Shop ID: @item.Shop_Id</p>
                </div>
            </li>
        }
    </ul>
</div>

<script>
    var selectedItems = []; // Array to store selected items

    function addToCart(itemId) {
        var index = selectedItems.findIndex(item => item.itemId === itemId);

        if (index !== -1) {
            selectedItems[index].amount++;
        } else {
            selectedItems.push({ itemId: itemId, amount: 1 });
        }

        document.getElementById('cartCounter').textContent = selectedItems.length;
    }

    function checkAuthentication() {
        if (!isLoggedIn()) {
            alert("Please log in to add items to the cart.");
            return false; // Prevent form submission
        }
        return true; // Allow form submission
    }

    function isLoggedIn() {
        // Check if the user is authenticated (adjust this logic based on your authentication setup)
        return @(User.Identity.IsAuthenticated.ToString().ToLower());
    }

    document.getElementById('cartForm').addEventListener('submit', function () {
        selectedItems.forEach(function (item) {
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'selectedItems[' + item.itemId + ']';
            input.value = item.amount;
            document.getElementById('cartForm').appendChild(input);
        });
    });
</script>
